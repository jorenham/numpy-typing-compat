{%- if py_start >= (3, 10) -%}
from typing import (
    TYPE_CHECKING,
    Any,
    Final,
    Literal,
{%- if np_start >= (2, 1) %}
    Protocol,
{%- endif %}
    TypeAlias,
    TypeVar,
)
{%- else -%}
import sys
from typing import (
    TYPE_CHECKING,
    Any,
    Final,
    Literal,
{%- if np_start >= (2, 1) %}
    Protocol,
{%- endif %}
{%- if py_start < (3, 9) %}
    Tuple,
{%- endif  %}
    TypeVar,
)

if sys.version_info >= (3, 10):
    from typing import TypeAlias
else:
    from typing_extensions import TypeAlias
{%- endif %}{# py_start >= (3, 10) #}

if TYPE_CHECKING:
    import numpy as np

{%- if np_start >= (2, 1) %}{# >=2.1 #}
    import numpy as array_api
    from numpy import long, ulong
    from numpy.dtypes import StringDType
{%- if np_start >= (2, 2) %}{# >=2.2 #}
    from numpy.polynomial._polybase import ABCPolyBase
{%- else %}{# >=2.1, <2.2 #}
    from numpy.polynomial._polybase import ABCPolyBase as _ABCPolyBase
    from typing_extensions import LiteralString

    ABCPolyBase: TypeAlias = _ABCPolyBase[LiteralString | None]
{%- endif %}{# >=2.1 #}
{%- elif np_start >= (2, 0) -%}{# >=2.0, <2.1 #}
    import numpy as array_api
    from numpy import dtype, long, ulong
    from numpy.polynomial._polybase import ABCPolyBase
    from typing_extensions import Never

    StringDType: TypeAlias = dtype[Never]
{%- else -%}{# <2.0 #}
    from typing_extensions import Never

    from numpy.polynomial._polybase import ABCPolyBase
    from numpy import int_ as long
    from numpy import uint as ulong
{%- if np_start >= (1, 23) %}{# >=1.23, <2.0 #}
    from numpy import array_api

{% else -%}{# <1.23 #}
    array_api: TypeAlias = Never
{%- endif %}{# >=1.23, <2.0 #}
    StringDType: TypeAlias = Never
{%- endif %}{# >=2.1 #}


__version__: Final[Literal["{{ project.version }}"]] = "{{ project.version }}"

__all__ = (
{%- for other in PROJECTS %}
    "{{ other.const_name }}",
{%- endfor %}
    "ABCPolyBase",
    "CanArray",
    "LiteralFalse",
    "LiteralTrue",
    "StringDType",
    "array_api",
    "long",
    "ulong",
    "_check_version",
    "__version__",
)

def __dir__() -> {% if py_start >= (3, 9) %}t{% else %}T{% endif %}uple[str, ...]:
    return __all__


__ALL_SET = frozenset(__all__)


def __getattr__(name: str, /) -> object:
{%- if np_start < (2, 1) %}
    if name == "CanArray":
        from numpy import ndarray
        return ndarray
{%- endif %}
{% if np_start >= (2, 0) %}
    if name == "StringDType":
        from numpy.dtypes import StringDType
        return StringDType
{%- endif %}
{% if np_start >= (1, 23) %}
    if name == "array_api":
        import numpy{% if np_start < (2, 0) %}.array_api{% endif %} as array_api
        return array_api
{%- endif %}

    if name == "long":
        from numpy import {% if np_start < (2, 0) %}int_ as {% endif %}long
        return long

    if name == "ulong":
        from numpy import {% if np_start < (2, 0) %}uint as {% endif %}ulong
        return ulong

    if name == "ABCPolyBase":
        from numpy.polynomial._polybase import ABCPolyBase
        return ABCPolyBase

    if name in __ALL_SET and name in globals():
        return globals()[name]

    raise AttributeError(f"module {__name__!r} has no attribute {name!r}")

{% for other in PROJECTS -%}
{% with is_ge = np_start >= other.np_range[0] -%}
{{ other.const_name }}: Final[Literal[{{ is_ge }}]] = {{ is_ge }}
{% endwith -%}
{% endfor %}

{% if np_start >= (2, 2) -%}
{#- stringified to avoid having to import numpy eagerly at runtime -#}
LiteralTrue: TypeAlias = "Literal[True] | np.bool[Literal[True]]"
LiteralFalse: TypeAlias = "Literal[False] | np.bool[Literal[False]]"
{%- else -%}
LiteralTrue: TypeAlias = Literal[True]
LiteralFalse: TypeAlias = Literal[False]
{%- endif %}


{% if np_start >= (2, 1) -%}
ShapeT_co = TypeVar("ShapeT_co", bound=tuple[int, ...], covariant=True)
DTypeT_co = TypeVar("DTypeT_co", bound="np.dtype[Any]", covariant=True)

class CanArray(Protocol[ShapeT_co, DTypeT_co]):
    def __array__(self, /) -> "np.ndarray[ShapeT_co, DTypeT_co]": ...

{%- else %}
if TYPE_CHECKING:
    ShapeT = TypeVar("ShapeT", bound=tuple[int, ...])
    DTypeT = TypeVar("DTypeT", bound=np.dtype[Any])

    CanArray: TypeAlias = np.ndarray[ShapeT, DTypeT]
{%- endif %}


def _check_version() -> bool:
    """Check if the `numpy-typing-compat` version is compatible with `numpy`."""
    import numpy as np

    np_version = tuple(map(int, np.__version__.split(".", 2)[:2]))
    return ({{ np_start[0] }}, {{ np_start[1] }}) <= np_version < ({{ np_stop[0] }}, {{ np_stop[1] }})
